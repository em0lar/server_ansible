---
- name: Create /docker/leomaroni.de/cloud.leomaroni.de directory
  file:
    path: '/docker/leomaroni.de/cloud.leomaroni.de'
    state: directory
    recurse: yes

- name: Create/Launch docker container cloud.leomaroni.de-mariadb
  docker_container:
    image: mariadb
    name: cloud.leomaroni.de-db
    volumes:
      - /docker/leomaroni.de/cloud.leomaroni.de/db-data:/var/lib/mysql
      - /etc/localtime:/etc/localtime:ro
    env:
      MYSQL_ROOT_PASSWORD: "{{ nextcloud_db_root_password }}"
      MYSQL_PASSWORD: "{{ nextcloud_db_password }}"
      MYSQL_DATABASE: "{{ nextcloud_db_database }}"
      MYSQL_USER: "{{ nextcloud_db_user }}"

- name: Create/launch docker container cloud.leomaroni.de-app
  docker_container:
    image: nextcloud:latest
    name: cloud.leomaroni.de-app
    links:
      - cloud.leomaroni.de-db:db
    volumes:
      - /docker/leomaroni.de/cloud.leomaroni.de/config:/var/www/html/config
      - /docker/leomaroni.de/cloud.leomaroni.de/custom_apps:/var/www/html/custom_apps
      - /docker/leomaroni.de/cloud.leomaroni.de/data:/var/www/html/data
      - /docker/leomaroni.de/cloud.leomaroni.de/themes:/var/www/html/themes
      - /etc/localtime:/etc/localtime:ro
    ports:
      127.0.0.1:40001:80
    env:
      MYSQL_HOST: "db"
      MYSQL_USER: "{{ nextcloud_db_user }}"
      MYSQL_DATABASE: "{{ nextcloud_db_database }}"
      MYSQL_PASSWORD: "{{ nextcloud_db_password }}"
      NEXTCLOUD_ADMIN_USER: "{{ nextcloud_admin_user }}"
      NEXTCLOUD_ADMIN_PASSWORD: "{{ nextcloud_admin_password }}"