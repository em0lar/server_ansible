---
- name: Add/Modify DNS record for cdn.labcode.de
  cloudflare_dns:
    account_email: "{{ cloudflare_api_email }}"
    account_api_token: "{{ cloudflare_api_token }}"
    record: "cdn"
    value: "{{ ansible_fqdn }}"
    type: CNAME
    zone: "labcode.de"
    state: present

- name: download cdn.labcode.de from GitLab
  git:
    repo: 'https://labcode-de:{{ vault_web_gitlab_password }}@gitlab.com/labcode_dev/cdn.labcode.de.git'
    dest: /var/www/labcode.de/cdn.labcode.de

- name: Add nginx config for cdn.labcode.de
  copy:
    src: nginx_vhost.conf
    dest: /etc/nginx/vhosts/cdn+labcode_de.conf
  notify:
    - reload nginx

- name: Add traefik config for cdn.labcode.de
  template:
    src: traefik.yml
    dest: /volume/docker/traefik/config/dynamic/cdn_labcode_de.yml